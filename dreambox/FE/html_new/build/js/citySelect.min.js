/*! dreambox 2014-09-12 */
(function(a) {
    a.fn.citySelect = function(b) {
        if (this.length < 1) {
            return;
        }
        b = a.extend({
            provUrl: "assets/js/citys.json",
            cityUrl: "assets/js/citys.json",
            distUrl: "assets/js/citys.json",
            schoolUrl: "assets/js/citys.json",
            prov: ".prov",
            city: ".city",
            dist: ".dist",
            school: ".school"
        }, b);
        var c = this, d = c.find(b.prov), e = c.find(b.city), f = c.find(b.dist), g = c.find(b.school), h, j = '<div class="select-city-wrap"><a class="close" href="javascript:;"><i class="icons close"></i></a><div class="title"><a class="sc-part fta active" href="javascript:;">ABCDEF</a><a class="sc-part" href="javascript:;">GHIJ</a><a class="sc-part" href="javascript:;">KLMN</a><a class="sc-part" href="javascript:;">PRRSTUVW</a><a class="sc-part" href="javascript:;">XYZ</a></div><div class="sc-main"><div class="loading"><img src="images/loading.gif" alt="loading"></div></div></div>';
        function k(b, c) {
            if (a(".select-city-wrap:visible").size() > 0) {
                a(".select-city-wrap:visible").remove();
            }
            if (typeof c == "string") {
                a.getJSON(c, function(c) {
                    var h = "", k, l;
                    switch (b) {
                      case "prov":
                        l = d;
                        break;

                      case "city":
                        l = e;
                        break;

                      case "dist":
                        l = f;
                        break;

                      case "school":
                        l = g;
                        break;

                      default:
                        break;
                    }
                    l.parent().find(".select-city-wrap").remove();
                    l.parent().append(j);
                    a.each(c, function(a, b) {
                        if (a == "A" || a == "G" || a == "K" || a == "P" || a == "X") {
                            h += '<div class="sc-main-part">';
                        }
                        h = h + "<p><span>" + a + "</span>";
                        for (i in b) {
                            h = h + '<a href="javascript:;">' + (b[i].n == undefined ? "未开放" : b[i].n) + "</a>";
                        }
                        if (b == "" || b == null || b == undefined) {
                            h += "未开放";
                        }
                        h += "</p>";
                        if (a == "F" || a == "J" || a == "N" || a == "W" || a == "Z") {
                            h += "</div>";
                        }
                    });
                    k = l.parent().find(".select-city-wrap");
                    k.find(".sc-main").append(h);
                    k.find(".title .sc-part:eq(0)").addClass("active");
                    k.find(".loading").hide();
                    k.find(".sc-main-part:eq(0)").show();
                    k.find(".title .sc-part").hover(function() {
                        var b = a(this).index();
                        a(this).parents(".title").find(".sc-part.active").removeClass("active");
                        a(this).addClass("active");
                        k.find(".sc-main-part").hide();
                        k.find(".sc-main-part").eq(b).show();
                    }, function() {});
                    k.find(".sc-main").click(function(b) {
                        var c = a(b.target);
                        if (c.is("a") && !c.hasClass(".sc-part")) {
                            l.val(c.text());
                            k.hide();
                        }
                    });
                    k.find("a.close").click(function(a) {
                        k.hide();
                    });
                });
            }
        }
        var l = function() {
            d.bind("click", function() {
                k("prov", b.provUrl);
            });
            e.bind("click", function() {
                k("city", b.cityUrl);
            });
            f.bind("click", function() {
                k("dist", b.distUrl);
            });
            g.bind("click", function() {
                k("school", b.schoolUrl);
            });
        };
        l();
    };
})(jQuery);